<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"xht03.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="整体架构 我设计的RV64-CPU总共有14个模块：  PC：更新下一条指令地址。 PCincrement：将PC加4，作为PCNext的可能值。 PCNext：根据Jump和CndCode信号，判断PC是跳转还是累加，计算出PCNext值。 InstMem：指令内存。根据PC值取出指令并解析。 RegFile：寄存器文件。执行读取和写回操作。 ImmGen：立即数生成器。将立即数补位成64位。">
<meta property="og:type" content="article">
<meta property="og:title" content="RV64单周期CPU">
<meta property="og:url" content="http://xht03.github.io/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/index.html">
<meta property="og:site_name" content="延绪的水上书">
<meta property="og:description" content="整体架构 我设计的RV64-CPU总共有14个模块：  PC：更新下一条指令地址。 PCincrement：将PC加4，作为PCNext的可能值。 PCNext：根据Jump和CndCode信号，判断PC是跳转还是累加，计算出PCNext值。 InstMem：指令内存。根据PC值取出指令并解析。 RegFile：寄存器文件。执行读取和写回操作。 ImmGen：立即数生成器。将立即数补位成64位。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://xht03.github.io/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/RISC-V.png">
<meta property="og:image" content="http://xht03.github.io/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/ISA.png">
<meta property="og:image" content="http://xht03.github.io/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/wave1.png">
<meta property="og:image" content="http://xht03.github.io/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/wave2.png">
<meta property="article:published_time" content="2024-03-06T00:04:28.000Z">
<meta property="article:modified_time" content="2024-05-13T08:09:37.167Z">
<meta property="article:author" content="xht03">
<meta property="article:tag" content="original">
<meta property="article:tag" content="homework">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xht03.github.io/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/RISC-V.png">

<link rel="canonical" href="http://xht03.github.io/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>RV64单周期CPU | 延绪的水上书</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">延绪的水上书</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xht03.github.io/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xht03">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="延绪的水上书">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RV64单周期CPU
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-03-06 08:04:28" itemprop="dateCreated datePublished" datetime="2024-03-06T08:04:28+08:00">2024-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-05-13 16:09:37" itemprop="dateModified" datetime="2024-05-13T16:09:37+08:00">2024-05-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ICS/" itemprop="url" rel="index"><span itemprop="name">ICS</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2024/03/06/RV64单周期CPU/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="整体架构"><a href="#整体架构" class="headerlink" title="整体架构"></a>整体架构</h3><p><img src="/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/RISC-V.png" alt="架构图"></p>
<p>我设计的RV64-CPU总共有14个模块：</p>
<ul>
<li>PC：更新下一条指令地址。</li>
<li>PCincrement：将PC加4，作为PCNext的可能值。</li>
<li>PCNext：根据Jump和CndCode信号，判断PC是跳转还是累加，计算出PCNext值。</li>
<li>InstMem：指令内存。根据PC值取出指令并解析。</li>
<li>RegFile：寄存器文件。执行读取和写回操作。</li>
<li>ImmGen：立即数生成器。将立即数补位成64位。</li>
<li>Control：控制模块。判断指令类型，并输出控制信号。</li>
<li>ALU_A：选择ALU端口A的数据来源。</li>
<li>ALU_B：选择ALU端口B的数据来源。</li>
<li>ALU_control：选择ALU功能。</li>
<li>ALU：执行算术逻辑运算。</li>
<li>DataMem：数据内存。执行写入和读取内存操作。</li>
<li>Conditional：计算Conditional Code。</li>
<li>RegBack：选择写回寄存器的数据来源。</li>
</ul>
<p>其中控制信号有以下：</p>
<ul>
<li>Branch：是否是Branch类指令</li>
<li>Jump：是否是<code>jal</code>指令</li>
<li>JumpReg：是否是<code>jalr</code>指令</li>
<li>MemRead：是否读取内存</li>
<li>MemWrite：是否写入内存</li>
<li>ALUop：指令类型</li>
<li>ALUSrc：ALU_B数据来源</li>
<li>RegWrite：是否写回寄存器</li>
<li>Halt：停止执行</li>
</ul>
<p>我没有设置MemtoReg信号。这是因为：目前，MemtoReg信号和MemRead信号一致，读取内存一定是存进寄存器里。</p>
<h3 id="RISC-V指令集"><a href="#RISC-V指令集" class="headerlink" title="RISC-V指令集 "></a><a target="_blank" rel="noopener" href="https://www.cs.sfu.ca/~ashriram/Courses/CS295/assets/notebooks/RISCV/RISCV_CARD.pdf">RISC-V指令集 </a></h3><p>我设计的CPU支持所有RV32I Base Integer Instruction（除<code>ecall</code>、<code>ebreak</code>外）。</p>
<p><img src="/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/ISA.png" alt="指令集"></p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><h4 id="PC"><a href="#PC" class="headerlink" title="PC"></a>PC</h4><blockquote>
<p>在时钟上升沿更新PC值。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> PC(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> clk,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCnext,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCaddress</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        PCaddress &lt;= PCnext;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="PCincrement"><a href="#PCincrement" class="headerlink" title="PCincrement"></a>PCincrement</h4><blockquote>
<p>计算PC累加值，作为<code>PCNext</code>的可能值。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> PCincrement(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCaddress,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCincrement</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        PCincrement = PCaddress + <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="PCNext"><a href="#PCNext" class="headerlink" title="PCNext"></a>PCNext</h4><blockquote>
<p>根据<code>Conditional Code</code>、<code>Jump</code>、<code>JumpReg</code>信号，计算<code>PCNext</code>值。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> PCNext(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCaddress,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCincrement,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] Imm,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] Rs1,         <span class="comment">// jalr会用到rs1</span></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> Jump,               <span class="comment">// jal</span></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> JumpReg,            <span class="comment">// jalr</span></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> CndCode,            <span class="comment">// branch</span></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> Halt,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCnext</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(CndCode) PCnext = PCaddress + Imm;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Jump) PCnext = PCaddress + Imm;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(JumpReg) PCnext = Rs1 + Imm;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Halt) PCnext = PCaddress;</span><br><span class="line">        <span class="keyword">else</span> PCnext = PCincrement;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="Control"><a href="#Control" class="headerlink" title="Control"></a>Control</h4><blockquote>
<p>根据<code>OpCode</code>判断指令类型，并产生控制信号，指导：ALU运算、寄存器读写、内存读写、PC更新。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">ALUop</th>
<th align="center">指令类型</th>
</tr>
</thead>
<tbody><tr>
<td align="center">000</td>
<td align="center">R-type</td>
</tr>
<tr>
<td align="center">001</td>
<td align="center">I1-type</td>
</tr>
<tr>
<td align="center">010</td>
<td align="center">I2-type（Load类指令）</td>
</tr>
<tr>
<td align="center">011</td>
<td align="center">S-tpye</td>
</tr>
<tr>
<td align="center">100</td>
<td align="center">B-type</td>
</tr>
<tr>
<td align="center">101</td>
<td align="center">J-type</td>
</tr>
<tr>
<td align="center">110</td>
<td align="center">U-type</td>
</tr>
</tbody></table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Control(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] OpCode,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> Branch,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> Jump,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> JumpReg,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> MemRead,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> MemWrite,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] ALUop,       <span class="comment">// 指令类型</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> ALUSrc,            <span class="comment">// 0:Rs2 1:imm</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> RegWrite,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> Halt               <span class="comment">// 1:停机 0:正常运行</span></span><br><span class="line">);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *ALUop:</span></span><br><span class="line"><span class="comment">    *000:R-type 001:I1-type 010:I2-type 011:S-type</span></span><br><span class="line"><span class="comment">    *100:B-type 101:J-type 	110:U-type</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(OpCode)</span><br><span class="line">            <span class="number">7&#x27;b0110011</span>: <span class="keyword">begin</span>       <span class="comment">// R-type</span></span><br><span class="line">                Branch = <span class="number">0</span>; Jump = <span class="number">0</span>; JumpReg = <span class="number">0</span>;</span><br><span class="line">                MemRead = <span class="number">0</span>; MemWrite = <span class="number">0</span>;</span><br><span class="line">                ALUop = <span class="number">3&#x27;b000</span>; ALUSrc = <span class="number">0</span>;</span><br><span class="line">                RegWrite = <span class="number">1</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">7&#x27;b0010011</span>: <span class="keyword">begin</span>       <span class="comment">// I1-type</span></span><br><span class="line">                Branch = <span class="number">0</span>; Jump = <span class="number">0</span>; JumpReg = <span class="number">0</span>;</span><br><span class="line">                MemRead = <span class="number">0</span>; MemWrite = <span class="number">0</span>;</span><br><span class="line">                ALUop = <span class="number">3&#x27;b001</span>; ALUSrc = <span class="number">1</span>;</span><br><span class="line">                RegWrite = <span class="number">1</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">7&#x27;b0000011</span>: <span class="keyword">begin</span>       <span class="comment">// I2-type</span></span><br><span class="line">                Branch = <span class="number">0</span>; Jump = <span class="number">0</span>; JumpReg = <span class="number">0</span>;</span><br><span class="line">                MemRead = <span class="number">1</span>; MemWrite = <span class="number">0</span>;</span><br><span class="line">                ALUop = <span class="number">3&#x27;b010</span>; ALUSrc = <span class="number">1</span>;</span><br><span class="line">                RegWrite = <span class="number">1</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">7&#x27;b0100011</span>: <span class="keyword">begin</span>       <span class="comment">// S-type</span></span><br><span class="line">                Branch = <span class="number">0</span>; Jump = <span class="number">0</span>; JumpReg = <span class="number">0</span>;</span><br><span class="line">                MemRead = <span class="number">0</span>; MemWrite = <span class="number">1</span>;</span><br><span class="line">                ALUop = <span class="number">3&#x27;b011</span>; ALUSrc = <span class="number">1</span>;</span><br><span class="line">                RegWrite = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">7&#x27;b1100011</span>: <span class="keyword">begin</span>       <span class="comment">// B-type</span></span><br><span class="line">                Branch = <span class="number">1</span>; Jump = <span class="number">0</span>; JumpReg = <span class="number">0</span>;</span><br><span class="line">                MemRead = <span class="number">0</span>; MemWrite = <span class="number">0</span>;</span><br><span class="line">                ALUop = <span class="number">3&#x27;b100</span>; ALUSrc = <span class="number">0</span>;</span><br><span class="line">                RegWrite = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">7&#x27;b1101111</span>: <span class="keyword">begin</span>       <span class="comment">// J-type (jal)</span></span><br><span class="line">                Branch = <span class="number">0</span>; Jump = <span class="number">1</span>; JumpReg = <span class="number">0</span>;</span><br><span class="line">                MemRead = <span class="number">0</span>; MemWrite = <span class="number">0</span>;</span><br><span class="line">                ALUop = <span class="number">3&#x27;b101</span>; ALUSrc = <span class="number">0</span>;</span><br><span class="line">                RegWrite = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">7&#x27;b1100111</span>: <span class="keyword">begin</span>       <span class="comment">// jarl</span></span><br><span class="line">                Branch = <span class="number">0</span>; Jump = <span class="number">0</span>; JumpReg = <span class="number">1</span>;</span><br><span class="line">                MemRead = <span class="number">0</span>; MemWrite = <span class="number">0</span>;</span><br><span class="line">                ALUop = <span class="number">3&#x27;b101</span>; ALUSrc = <span class="number">1</span>;</span><br><span class="line">                RegWrite = <span class="number">1</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">7&#x27;b0110111</span>: <span class="keyword">begin</span>       <span class="comment">// U-type(lui)</span></span><br><span class="line">                Branch = <span class="number">0</span>; Jump = <span class="number">0</span>; JumpReg = <span class="number">0</span>;</span><br><span class="line">                MemRead = <span class="number">0</span>; MemWrite = <span class="number">0</span>;</span><br><span class="line">                ALUop = <span class="number">3&#x27;b110</span>; ALUSrc = <span class="number">1</span>;</span><br><span class="line">                RegWrite = <span class="number">1</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">7&#x27;b0010111</span>: <span class="keyword">begin</span>       <span class="comment">// U-type(auipc)</span></span><br><span class="line">                Branch = <span class="number">0</span>; Jump = <span class="number">0</span>; JumpReg = <span class="number">0</span>;</span><br><span class="line">                MemRead = <span class="number">0</span>; MemWrite = <span class="number">0</span>;</span><br><span class="line">                ALUop = <span class="number">3&#x27;b110</span>; ALUSrc = <span class="number">1</span>;</span><br><span class="line">                RegWrite = <span class="number">1</span>;</span><br><span class="line">                Halt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">begin</span></span><br><span class="line">                Branch = <span class="number">0</span>; Jump = <span class="number">0</span>; JumpReg = <span class="number">0</span>;</span><br><span class="line">                MemRead = <span class="number">0</span>; MemWrite = <span class="number">0</span>;</span><br><span class="line">                ALUop = <span class="number">3&#x27;b000</span>; ALUSrc = <span class="number">0</span>;</span><br><span class="line">                RegWrite = <span class="number">0</span>;</span><br><span class="line">                Halt = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="InstMem"><a href="#InstMem" class="headerlink" title="InstMem"></a>InstMem</h4><blockquote>
<p>根据<code>PCaddress</code>读取指令，并拆解为<code>OpCode</code>、<code>Rs1</code>、<code>Rs2</code>、<code>Rd</code>。<code>Inst</code>是完整指令，用于生成立即数。</p>
</blockquote>
<blockquote>
<p>为了后续便于验证正确性，这里预先写入两条指令。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> InstMem(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCaddress,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] OpCode,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">4</span>:<span class="number">0</span>] Rs1,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">4</span>:<span class="number">0</span>] Rs2,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">4</span>:<span class="number">0</span>] Rd,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] Inst</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">7</span>:<span class="number">0</span>] mem[<span class="number">0</span>:<span class="number">1023</span>];</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] instruction;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        mem[<span class="number">0</span>] = <span class="number">8&#x27;b10110111</span>;        <span class="comment">// b7  ( lui x5, 0x12345)</span></span><br><span class="line">        mem[<span class="number">1</span>] = <span class="number">8&#x27;b00000010</span>;       <span class="comment">//  02</span></span><br><span class="line">        mem[<span class="number">2</span>] = <span class="number">8&#x27;b01101000</span>;       <span class="comment">//  68</span></span><br><span class="line">        mem[<span class="number">3</span>] = <span class="number">8&#x27;b00010010</span>;       <span class="comment">//  12</span></span><br><span class="line">        mem[<span class="number">4</span>] = <span class="number">8&#x27;b10110011</span>;       <span class="comment">//  b3  ( add x7, x5, x6)</span></span><br><span class="line">        mem[<span class="number">5</span>] = <span class="number">8&#x27;b00000011</span>;       <span class="comment">//  03</span></span><br><span class="line">        mem[<span class="number">6</span>] = <span class="number">8&#x27;b01010011</span>;       <span class="comment">//  53</span></span><br><span class="line">        mem[<span class="number">7</span>] = <span class="number">8&#x27;b00000000</span>;       <span class="comment">//  00</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        instruction = &#123;mem[PCaddress+<span class="number">3</span>], mem[PCaddress+<span class="number">2</span>], mem[PCaddress+<span class="number">1</span>], mem[PCaddress]&#125;;</span><br><span class="line">        OpCode = instruction[<span class="number">6</span>:<span class="number">0</span>];</span><br><span class="line">        Rs1 = instruction[<span class="number">19</span>:<span class="number">15</span>];</span><br><span class="line">        Rs2 = instruction[<span class="number">24</span>:<span class="number">20</span>];</span><br><span class="line">        Rd = instruction[<span class="number">11</span>:<span class="number">7</span>];</span><br><span class="line">        Inst = instruction;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="RegFile"><a href="#RegFile" class="headerlink" title="RegFile"></a>RegFile</h4><blockquote>
<p>对寄存器文件进行读写操作。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> RegFile(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> clk,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">4</span>:<span class="number">0</span>] ReadReg1,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">4</span>:<span class="number">0</span>] ReadReg2,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">4</span>:<span class="number">0</span>] WriteReg,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> RegWrite,   <span class="comment">// 是否写入寄存器</span></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] WriteData,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ReadData1,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ReadData2</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] regs[<span class="number">0</span>:<span class="number">31</span>];     <span class="comment">// 32个64-bit寄存器</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span>      <span class="comment">// write是时序的</span></span><br><span class="line">        <span class="keyword">if</span>(RegWrite) <span class="keyword">begin</span></span><br><span class="line">            regs[WriteReg] &lt;= WriteData;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span>		<span class="comment">// read是组合的</span></span><br><span class="line">        ReadData1 = regs[ReadReg1];</span><br><span class="line">        ReadData2 = regs[ReadReg2];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="ImmGen"><a href="#ImmGen" class="headerlink" title="ImmGen"></a>ImmGen</h4><blockquote>
<p>根据<code>Inst</code>判断指令类型，根据不同指令，采取不同方式补位立即数。</p>
</blockquote>
<blockquote>
<p><code>funct7_30</code>是 funct7 的1个 bit ，指令中的第30个 bit 。funct7 中其余部分都是0，真正有区分作用的仅<code>funct7_30</code>一位。（区分<code>srai</code>和<code>srli</code>时）</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> ImmGen(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] Inst,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] Imm</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] opcode;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] funct3;</span><br><span class="line">    <span class="keyword">logic</span> funct7_30;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> opcode = Inst[<span class="number">6</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> funct3 = Inst[<span class="number">14</span>:<span class="number">12</span>];</span><br><span class="line">    <span class="keyword">assign</span> funct7_30 = Inst[<span class="number">30</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(opcode)</span><br><span class="line">            <span class="number">7&#x27;b0010011</span>: <span class="keyword">begin</span>                                   <span class="comment">// I-type</span></span><br><span class="line">                <span class="keyword">if</span>(funct3 == <span class="number">3&#x27;b101</span> &amp;&amp; funct7_30 == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                    Imm =&#123;&#123;(<span class="number">64</span> - <span class="number">5</span>)&#123;Inst[<span class="number">24</span>]&#125;&#125;,Inst[<span class="number">24</span>:<span class="number">20</span>]&#125;;</span><br><span class="line">                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    Imm = &#123;&#123;(<span class="number">64</span> - <span class="number">12</span>)&#123;Inst[<span class="number">31</span>]&#125;&#125;, Inst[<span class="number">31</span>:<span class="number">20</span>]&#125;;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">7&#x27;b0000011</span>: Imm = &#123;&#123;(<span class="number">64</span> - <span class="number">12</span>)&#123;Inst[<span class="number">31</span>]&#125;&#125;, Inst[<span class="number">31</span>:<span class="number">20</span>]&#125;;    <span class="comment">// I-type(load)</span></span><br><span class="line">            <span class="number">7&#x27;b0100011</span>: Imm = &#123;&#123;(<span class="number">64</span> - <span class="number">12</span>)&#123;Inst[<span class="number">31</span>]&#125;&#125;, Inst[<span class="number">31</span>:<span class="number">25</span>], Inst[<span class="number">11</span>:<span class="number">7</span>]&#125;;    <span class="comment">// S-type</span></span><br><span class="line">            <span class="number">7&#x27;b1100011</span>: Imm = &#123;&#123;(<span class="number">64</span> - <span class="number">13</span>)&#123;Inst[<span class="number">31</span>]&#125;&#125;, Inst[<span class="number">31</span>], Inst[<span class="number">7</span>], Inst[<span class="number">30</span>:<span class="number">25</span>], Inst[<span class="number">11</span>:<span class="number">8</span>], <span class="number">1&#x27;b0</span>&#125;;    <span class="comment">// B-type</span></span><br><span class="line">            <span class="number">7&#x27;b1101111</span>: Imm = &#123;&#123;(<span class="number">64</span> - <span class="number">21</span>)&#123;Inst[<span class="number">31</span>]&#125;&#125;, Inst[<span class="number">31</span>], Inst[<span class="number">19</span>:<span class="number">12</span>], Inst[<span class="number">20</span>], Inst[<span class="number">30</span>:<span class="number">21</span>], <span class="number">1&#x27;b0</span>&#125;;    <span class="comment">// J-type(jal)</span></span><br><span class="line">            <span class="number">7&#x27;b1100111</span>: Imm = &#123;&#123;(<span class="number">64</span> - <span class="number">12</span>)&#123;Inst[<span class="number">31</span>]&#125;&#125;, Inst[<span class="number">31</span>:<span class="number">20</span>]&#125;;    <span class="comment">// jalr</span></span><br><span class="line">            <span class="number">7&#x27;b0110111</span>: Imm = &#123;&#123;(<span class="number">64</span> - <span class="number">32</span>)&#123;Inst[<span class="number">31</span>]&#125;&#125;, Inst[<span class="number">31</span>:<span class="number">12</span>], <span class="number">12&#x27;b0</span>&#125;;    <span class="comment">// U-type(lui)</span></span><br><span class="line">            <span class="number">7&#x27;b0010111</span>: Imm = &#123;&#123;(<span class="number">64</span> - <span class="number">32</span>)&#123;Inst[<span class="number">31</span>]&#125;&#125;, Inst[<span class="number">31</span>:<span class="number">12</span>], <span class="number">12&#x27;b0</span>&#125;;    <span class="comment">// U-type(auipc)</span></span><br><span class="line">            <span class="keyword">default</span>: Imm = <span class="number">64&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="ALU-control"><a href="#ALU-control" class="headerlink" title="ALU_control"></a>ALU_control</h4><blockquote>
<p>根据指令类型，选择ALU具体功能<code>ALUfunc</code>。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> ALU_control(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] ALUop,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] funct3,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> funct7_30,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] ALUfunc</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(ALUop)</span><br><span class="line">            <span class="number">3&#x27;b000</span>: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">case</span>(funct3)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: <span class="keyword">begin</span></span><br><span class="line">                        <span class="keyword">case</span>(funct7_30)</span><br><span class="line">                            <span class="number">1&#x27;b0</span>: ALUfunc = <span class="number">3&#x27;b000</span>;     <span class="comment">// add</span></span><br><span class="line">                            <span class="number">1&#x27;b1</span>: ALUfunc = <span class="number">3&#x27;b001</span>;     <span class="comment">// sub</span></span><br><span class="line">                        <span class="keyword">endcase</span></span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="number">3&#x27;b001</span>: ALUfunc = <span class="number">3&#x27;b101</span>;           <span class="comment">// sll(&lt;&lt;)</span></span><br><span class="line">                    <span class="number">3&#x27;b010</span>: ALUfunc = <span class="number">3&#x27;b001</span>;           <span class="comment">// slt(做减法运算)</span></span><br><span class="line">                    <span class="number">3&#x27;b011</span>: ALUfunc = <span class="number">3&#x27;b001</span>;           <span class="comment">// sltu(做减法运算)</span></span><br><span class="line">                    <span class="number">3&#x27;b100</span>: ALUfunc = <span class="number">3&#x27;b100</span>;           <span class="comment">// xor</span></span><br><span class="line">                    <span class="number">3&#x27;b101</span>: <span class="keyword">begin</span></span><br><span class="line">                        <span class="keyword">case</span>(funct7_30)</span><br><span class="line">                            <span class="number">1&#x27;b0</span>: ALUfunc = <span class="number">3&#x27;b111</span>;     <span class="comment">// srl(&gt;&gt;&gt;)</span></span><br><span class="line">                            <span class="number">1&#x27;b1</span>: ALUfunc = <span class="number">3&#x27;b110</span>;     <span class="comment">// sra(&gt;&gt;)</span></span><br><span class="line">                        <span class="keyword">endcase</span></span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="number">3&#x27;b110</span>: ALUfunc = <span class="number">3&#x27;b011</span>;           <span class="comment">// or</span></span><br><span class="line">                    <span class="number">3&#x27;b111</span>: ALUfunc = <span class="number">3&#x27;b010</span>;           <span class="comment">// and</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">3&#x27;b001</span>: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">case</span>(funct3)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: ALUfunc = <span class="number">3&#x27;b000</span>;           <span class="comment">// add</span></span><br><span class="line">                    <span class="number">3&#x27;b001</span>: ALUfunc = <span class="number">3&#x27;b101</span>;           <span class="comment">// sll(&lt;&lt;)</span></span><br><span class="line">                    <span class="number">3&#x27;b010</span>: ALUfunc = <span class="number">3&#x27;b001</span>;           <span class="comment">// slt(做减法运算)</span></span><br><span class="line">                    <span class="number">3&#x27;b011</span>: ALUfunc = <span class="number">3&#x27;b001</span>;           <span class="comment">// sltu(做减法运算)</span></span><br><span class="line">                    <span class="number">3&#x27;b100</span>: ALUfunc = <span class="number">3&#x27;b100</span>;           <span class="comment">// xor</span></span><br><span class="line">                    <span class="number">3&#x27;b101</span>: <span class="keyword">begin</span></span><br><span class="line">                        <span class="keyword">case</span>(funct7_30)</span><br><span class="line">                            <span class="number">1&#x27;b0</span>: ALUfunc = <span class="number">3&#x27;b111</span>;     <span class="comment">// srl(&gt;&gt;&gt;)</span></span><br><span class="line">                            <span class="number">1&#x27;b1</span>: ALUfunc = <span class="number">3&#x27;b110</span>;     <span class="comment">// sra(&gt;&gt;)</span></span><br><span class="line">                        <span class="keyword">endcase</span></span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="number">3&#x27;b110</span>: ALUfunc = <span class="number">3&#x27;b011</span>;           <span class="comment">// or</span></span><br><span class="line">                    <span class="number">3&#x27;b111</span>: ALUfunc = <span class="number">3&#x27;b010</span>;           <span class="comment">// and</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">3&#x27;b010</span>: ALUfunc = <span class="number">3&#x27;b000</span>;                   <span class="comment">// load类指令 add</span></span><br><span class="line">            <span class="number">3&#x27;b011</span>: ALUfunc = <span class="number">3&#x27;b000</span>;                   <span class="comment">// store类指令 add</span></span><br><span class="line">            <span class="number">3&#x27;b100</span>: ALUfunc = <span class="number">3&#x27;b001</span>;                   <span class="comment">// branch类指令 sub</span></span><br><span class="line">            <span class="number">3&#x27;b101</span>: ALUfunc = <span class="number">3&#x27;b000</span>;                   <span class="comment">// jump类指令 add</span></span><br><span class="line">            <span class="number">3&#x27;b110</span>: ALUfunc = <span class="number">3&#x27;b000</span>;                   <span class="comment">// U-type指令 add</span></span><br><span class="line">            <span class="keyword">default</span>: ALUfunc = <span class="number">3&#x27;b000</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="ALU-A"><a href="#ALU-A" class="headerlink" title="ALU_A"></a>ALU_A</h4><blockquote>
<p>选择<code>AluA</code>的数据来源。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> ALU_A(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">3</span>:<span class="number">0</span>] ALUop,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] OpCode,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ReadData1,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCaddress,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] AluA</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(ALUop)</span><br><span class="line">            <span class="number">3&#x27;b000</span>: AluA = ReadData1;   <span class="comment">// R-type</span></span><br><span class="line">            <span class="number">3&#x27;b001</span>: AluA = ReadData1;   <span class="comment">// I1-type</span></span><br><span class="line">            <span class="number">3&#x27;b010</span>: AluA = ReadData1;   <span class="comment">// I2-type</span></span><br><span class="line">            <span class="number">3&#x27;b011</span>: AluA = ReadData1;   <span class="comment">// S-type</span></span><br><span class="line">            <span class="number">3&#x27;b100</span>: AluA = ReadData1;   <span class="comment">// B-type</span></span><br><span class="line">            <span class="number">3&#x27;b101</span>: AluA = PCaddress;   <span class="comment">// J-type</span></span><br><span class="line">            <span class="number">3&#x27;b110</span>: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>(OpCode == <span class="number">7&#x27;b0110111</span>) <span class="keyword">begin</span></span><br><span class="line">                    AluA = <span class="number">64&#x27;b0</span>;                       <span class="comment">// U-type(lui)</span></span><br><span class="line">                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(OpCode == <span class="number">7&#x27;b0010111</span>)<span class="keyword">begin</span></span><br><span class="line">                    AluA = PCaddress;                   <span class="comment">// U-type(auipc)</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">default</span>: AluA = <span class="number">64&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="ALU-B"><a href="#ALU-B" class="headerlink" title="ALU_B"></a>ALU_B</h4><blockquote>
<p>选择<code>AluB</code>的数据来源。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> ALU_B(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] OpCode,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> ALUSrc,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ReadData2,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] Imm,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] AluB</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(ALUSrc) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(OpCode == <span class="number">7&#x27;b1101111</span> || OpCode == <span class="number">7&#x27;b1100111</span>) <span class="keyword">begin</span>      <span class="comment">// J-type(jal, jalr)</span></span><br><span class="line">                AluB = <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                AluB = Imm;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            AluB = ReadData2;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="ALU"><a href="#ALU" class="headerlink" title="ALU"></a>ALU</h4><blockquote>
<p>执行算术逻辑运算。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> ALU(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] A,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] B,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] ALUfunc,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] result,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> Zero,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> SignedLess,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> UnsignedLess</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">assign</span> Zero = (result == <span class="number">64&#x27;b0</span>);</span><br><span class="line">    <span class="keyword">assign</span> SignedLess = (<span class="built_in">$signed</span>(A) &lt; <span class="built_in">$signed</span>(B));</span><br><span class="line">    <span class="keyword">assign</span> UnsignedLess = (A &lt; B);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span>(ALUfunc)</span><br><span class="line">            <span class="number">3&#x27;b000</span>: result = A + B;</span><br><span class="line">            <span class="number">3&#x27;b001</span>: result = A - B;</span><br><span class="line">            <span class="number">3&#x27;b010</span>: result = A &amp; B;</span><br><span class="line">            <span class="number">3&#x27;b011</span>: result = A | B;</span><br><span class="line">            <span class="number">3&#x27;b100</span>: result = A ^ B;</span><br><span class="line">            <span class="number">3&#x27;b101</span>: result = A &lt;&lt; B;</span><br><span class="line">            <span class="number">3&#x27;b110</span>: result = A &gt;&gt; B;</span><br><span class="line">            <span class="number">3&#x27;b111</span>: result = A &gt;&gt;&gt; B;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="DataMem"><a href="#DataMem" class="headerlink" title="DataMem"></a>DataMem</h4><blockquote>
<p>执行对数据内存的读写操作。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> DataMem(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] Address,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] WriteData,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> MemWrite,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> MemRead,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] funct3,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ReadData</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">7</span>:<span class="number">0</span>] mem[<span class="number">0</span>:<span class="number">1023</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(MemWrite) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span>(funct3)</span><br><span class="line">                <span class="number">3&#x27;h0</span>: mem[Address] = WriteData[<span class="number">7</span>:<span class="number">0</span>];</span><br><span class="line">                <span class="number">3&#x27;h1</span>: &#123;mem[Address], mem[Address+<span class="number">1</span>]&#125; = WriteData[<span class="number">15</span>:<span class="number">0</span>];</span><br><span class="line">                <span class="number">3&#x27;h2</span>: &#123;mem[Address], mem[Address+<span class="number">1</span>], mem[Address+<span class="number">2</span>], mem[Address+<span class="number">3</span>]&#125; = WriteData[<span class="number">31</span>:<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">if</span>(MemRead) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span>(funct3)</span><br><span class="line">                <span class="number">3&#x27;h0</span>: ReadData = &#123;&#123;(<span class="number">64</span> - <span class="number">8</span>)&#123;mem[Address][<span class="number">7</span>]&#125;&#125;, mem[Address]&#125;;</span><br><span class="line">                <span class="number">3&#x27;h1</span>: ReadData = &#123;&#123;(<span class="number">64</span> - <span class="number">16</span>)&#123;mem[Address][<span class="number">7</span>]&#125;&#125;, mem[Address], mem[Address+<span class="number">1</span>]&#125;;</span><br><span class="line">                <span class="number">3&#x27;h2</span>: ReadData = &#123;&#123;(<span class="number">64</span> - <span class="number">32</span>)&#123;mem[Address][<span class="number">7</span>]&#125;&#125;, mem[Address], mem[Address+<span class="number">1</span>], mem[Address+<span class="number">2</span>], mem[Address+<span class="number">3</span>]&#125;;</span><br><span class="line">                <span class="number">3&#x27;h4</span>: ReadData = &#123;&#123;(<span class="number">64</span> - <span class="number">8</span>)&#123;<span class="number">1&#x27;b0</span>&#125;&#125;, mem[Address]&#125;;</span><br><span class="line">                <span class="number">3&#x27;h5</span>: ReadData = &#123;&#123;(<span class="number">64</span> - <span class="number">16</span>)&#123;<span class="number">1&#x27;b0</span>&#125;&#125;, mem[Address], mem[Address+<span class="number">1</span>]&#125;;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="Conditional"><a href="#Conditional" class="headerlink" title="Conditional"></a>Conditional</h4><blockquote>
<p>根据ALU计算得到的符号位<code>Zere</code>、<code>SignedLess</code>、<code>UnsignedLess</code>，判断是否跳转，得到<code>CndCode</code>。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Conditional(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> Branch,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> Zero,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> SignedLess,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> UnsignedLess,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] funct3,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> CndCode        <span class="comment">// 是否满足条件跳转</span></span><br><span class="line">);</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(Branch) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span>(funct3)</span><br><span class="line">                <span class="number">3&#x27;h0</span>: <span class="keyword">if</span>(Zero) CndCode = <span class="number">1&#x27;b1</span>;  <span class="comment">// beq</span></span><br><span class="line">                <span class="number">3&#x27;h1</span>: <span class="keyword">if</span>(!Zero) CndCode = <span class="number">1&#x27;b1</span>;   <span class="comment">// bne</span></span><br><span class="line">                <span class="number">3&#x27;h4</span>: <span class="keyword">if</span>(SignedLess) CndCode = <span class="number">1&#x27;b1</span>;   <span class="comment">// blt</span></span><br><span class="line">                <span class="number">3&#x27;h5</span>: <span class="keyword">if</span>(!SignedLess) CndCode = <span class="number">1&#x27;b0</span>;   <span class="comment">// bge</span></span><br><span class="line">                <span class="number">3&#x27;h6</span>: <span class="keyword">if</span>(UnsignedLess) CndCode = <span class="number">1&#x27;b1</span>;   <span class="comment">// bltu</span></span><br><span class="line">                <span class="number">3&#x27;h7</span>: <span class="keyword">if</span>(!UnsignedLess) CndCode = <span class="number">1&#x27;b1</span>;   <span class="comment">// bgeu</span></span><br><span class="line">                <span class="keyword">default</span>: CndCode = <span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            CndCode = <span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="RegBack"><a href="#RegBack" class="headerlink" title="RegBack"></a>RegBack</h4><blockquote>
<p>选择写回寄存器的数据来源。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> RegBack(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> MemRead,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ReadData,    <span class="comment">// 从内存中读出的数据</span></span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ALUresult,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] WriteData</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(MemRead)<span class="keyword">begin</span></span><br><span class="line">            WriteData = ReadData;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            WriteData = ALUresult;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h4 id="arch"><a href="#arch" class="headerlink" title="arch"></a>arch</h4><blockquote>
<p>在顶层模块，完成连线。</p>
</blockquote>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> arch(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">logic</span> CLK</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCaddress;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCnext;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] PCincrement;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        PCaddress = <span class="number">64&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    PC pc(</span><br><span class="line">        <span class="variable">.clk</span>(CLK),</span><br><span class="line">        <span class="variable">.PCnext</span>(PCnext),</span><br><span class="line">        <span class="variable">.PCaddress</span>(PCaddress)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    PCincrement pcincrement(</span><br><span class="line">        <span class="variable">.PCaddress</span>(PCaddress),</span><br><span class="line">        <span class="variable">.PCincrement</span>(PCincrement)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] OpCode;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">4</span>:<span class="number">0</span>] Rs1;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">4</span>:<span class="number">0</span>] Rs2;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">4</span>:<span class="number">0</span>] Rd;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] Inst;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] Imm;</span><br><span class="line"></span><br><span class="line">    InstMem instmem(</span><br><span class="line">        <span class="variable">.PCaddress</span>(PCaddress),</span><br><span class="line">        <span class="variable">.OpCode</span>(OpCode),</span><br><span class="line">        <span class="variable">.Rs1</span>(Rs1),</span><br><span class="line">        <span class="variable">.Rs2</span>(Rs2),</span><br><span class="line">        <span class="variable">.Rd</span>(Rd),</span><br><span class="line">        <span class="variable">.Inst</span>(Inst)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> RegWrite;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] WriteData;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ReadData1;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ReadData2;</span><br><span class="line"></span><br><span class="line">    RegFile regfile(</span><br><span class="line">        <span class="variable">.clk</span>(CLK),</span><br><span class="line">        <span class="variable">.ReadReg1</span>(Rs1),</span><br><span class="line">        <span class="variable">.ReadReg2</span>(Rs2),</span><br><span class="line">        <span class="variable">.WriteReg</span>(Rd),</span><br><span class="line">        <span class="variable">.RegWrite</span>(RegWrite),</span><br><span class="line">        <span class="variable">.WriteData</span>(WriteData),</span><br><span class="line">        <span class="variable">.ReadData1</span>(ReadData1),</span><br><span class="line">        <span class="variable">.ReadData2</span>(ReadData2)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    ImmGen immgen(</span><br><span class="line">        <span class="variable">.Inst</span>(Inst),</span><br><span class="line">        <span class="variable">.Imm</span>(Imm)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> Branch;</span><br><span class="line">    <span class="keyword">logic</span> Jump;</span><br><span class="line">    <span class="keyword">logic</span> JumpReg;</span><br><span class="line">    <span class="keyword">logic</span> MemRead;</span><br><span class="line">    <span class="keyword">logic</span> MemWrite;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] ALUop;</span><br><span class="line">    <span class="keyword">logic</span> ALUSrc;</span><br><span class="line">    <span class="keyword">logic</span> Halt;</span><br><span class="line"></span><br><span class="line">    Control control(</span><br><span class="line">        <span class="variable">.OpCode</span>(OpCode),</span><br><span class="line">        <span class="variable">.Branch</span>(Branch),</span><br><span class="line">        <span class="variable">.Jump</span>(Jump),</span><br><span class="line">        <span class="variable">.JumpReg</span>(JumpReg),</span><br><span class="line">        <span class="variable">.MemRead</span>(MemRead),</span><br><span class="line">        <span class="variable">.MemWrite</span>(MemWrite),</span><br><span class="line">        <span class="variable">.ALUop</span>(ALUop),</span><br><span class="line">        <span class="variable">.ALUSrc</span>(ALUSrc),</span><br><span class="line">        <span class="variable">.RegWrite</span>(RegWrite),</span><br><span class="line">        <span class="variable">.Halt</span>(Halt)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] ALUfunc;</span><br><span class="line"></span><br><span class="line">    ALU_control alu_control(</span><br><span class="line">        <span class="variable">.ALUop</span>(ALUop),</span><br><span class="line">        <span class="variable">.funct3</span>(Inst[<span class="number">14</span>:<span class="number">12</span>]),</span><br><span class="line">        <span class="variable">.funct7_30</span>(Inst[<span class="number">30</span>]),</span><br><span class="line">        <span class="variable">.ALUfunc</span>(ALUfunc)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] AluA;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] AluB;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ALUresult;</span><br><span class="line">    <span class="keyword">logic</span> Zero;</span><br><span class="line">    <span class="keyword">logic</span> SignedLess;</span><br><span class="line">    <span class="keyword">logic</span> UnsignedLess;</span><br><span class="line"></span><br><span class="line">    ALU_A alu_a(</span><br><span class="line">        <span class="variable">.ALUop</span>(ALUop),</span><br><span class="line">        <span class="variable">.OpCode</span>(OpCode),</span><br><span class="line">        <span class="variable">.ReadData1</span>(ReadData1),</span><br><span class="line">        <span class="variable">.PCaddress</span>(PCaddress),</span><br><span class="line">        <span class="variable">.AluA</span>(AluA)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    ALU_B alu_b(</span><br><span class="line">        <span class="variable">.OpCode</span>(OpCode),</span><br><span class="line">        <span class="variable">.ALUSrc</span>(ALUSrc),</span><br><span class="line">        <span class="variable">.ReadData2</span>(ReadData2),</span><br><span class="line">        <span class="variable">.Imm</span>(Imm),</span><br><span class="line">        <span class="variable">.AluB</span>(AluB)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    ALU alu(</span><br><span class="line">        <span class="variable">.A</span>(AluA),</span><br><span class="line">        <span class="variable">.B</span>(AluB),</span><br><span class="line">        <span class="variable">.ALUfunc</span>(ALUfunc),</span><br><span class="line">        <span class="variable">.result</span>(ALUresult),</span><br><span class="line">        <span class="variable">.Zero</span>(Zero),</span><br><span class="line">        <span class="variable">.SignedLess</span>(SignedLess),</span><br><span class="line">        <span class="variable">.UnsignedLess</span>(UnsignedLess)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] ReadData;      <span class="comment">// 从内存中读出的数据</span></span><br><span class="line"></span><br><span class="line">    DataMem datamem(</span><br><span class="line">        <span class="variable">.Address</span>(ALUresult),</span><br><span class="line">        <span class="variable">.WriteData</span>(ReadData2),</span><br><span class="line">        <span class="variable">.MemWrite</span>(MemWrite),</span><br><span class="line">        <span class="variable">.MemRead</span>(MemRead),</span><br><span class="line">        <span class="variable">.funct3</span>(Inst[<span class="number">14</span>:<span class="number">12</span>]),</span><br><span class="line">        <span class="variable">.ReadData</span>(ReadData)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    RegBack regback(</span><br><span class="line">        <span class="variable">.MemRead</span>(MemRead),</span><br><span class="line">        <span class="variable">.ReadData</span>(ReadData),</span><br><span class="line">        <span class="variable">.ALUresult</span>(ALUresult),</span><br><span class="line">        <span class="variable">.WriteData</span>(WriteData)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> CndCode;</span><br><span class="line"></span><br><span class="line">    Conditional conditional(</span><br><span class="line">        <span class="variable">.Branch</span>(Branch),</span><br><span class="line">        <span class="variable">.Zero</span>(Zero),</span><br><span class="line">        <span class="variable">.SignedLess</span>(SignedLess),</span><br><span class="line">        <span class="variable">.UnsignedLess</span>(UnsignedLess),</span><br><span class="line">        <span class="variable">.funct3</span>(Inst[<span class="number">14</span>:<span class="number">12</span>]),</span><br><span class="line">        <span class="variable">.CndCode</span>(CndCode)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    PCNext pcnext(</span><br><span class="line">        <span class="variable">.PCaddress</span>(PCaddress),</span><br><span class="line">        <span class="variable">.PCincrement</span>(PCincrement),</span><br><span class="line">        <span class="variable">.Imm</span>(Imm),</span><br><span class="line">        <span class="variable">.Rs1</span>(ReadData1),</span><br><span class="line">        <span class="variable">.Jump</span>(Jump),</span><br><span class="line">        <span class="variable">.JumpReg</span>(JumpReg),</span><br><span class="line">        <span class="variable">.CndCode</span>(CndCode),</span><br><span class="line">        <span class="variable">.Halt</span>(Halt),</span><br><span class="line">        <span class="variable">.PCnext</span>(PCnext)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<h3 id="正确性验证"><a href="#正确性验证" class="headerlink" title="正确性验证"></a>正确性验证</h3><p>为检验正确性，我向 InstMem 中写入了两条指令：</p>
<ul>
<li><p><code>lui x5, 0x12345	</code>：0x126802b7</p>
</li>
<li><p><code>add x7, x5, x6</code>：0x005303b3</p>
</li>
</ul>
<p>	</p>
<p>然后我们在 Vivado 中进行 synthesis 和 stimulation 。</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> sim();</span><br><span class="line">    <span class="keyword">logic</span> clk;</span><br><span class="line">    arch test(<span class="variable">.CLK</span>(clk));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">repeat</span> (<span class="number">20</span>) <span class="keyword">begin</span></span><br><span class="line">            clk = <span class="number">0</span>;</span><br><span class="line">            #<span class="number">5</span>;</span><br><span class="line">            clk = <span class="number">1</span>;</span><br><span class="line">            #<span class="number">5</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">$finish</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="built_in">$dumpfile</span>(<span class="string">&quot;test.vcd&quot;</span>);</span><br><span class="line">        <span class="built_in">$dumpvars</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<p>我们可以看到：指令都被正确解析。</p>
<p><img src="/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/wave1.png" alt="波形图"></p>
<p>我们查看Regfile中的5号、7号寄存器。它们都被正确地写入和读取。</p>
<p><img src="/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/wave2.png" alt="波形图2"></p>
<h3 id="注记"><a href="#注记" class="headerlink" title="注记"></a>注记</h3>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/original/" rel="tag"># original</a>
              <a href="/tags/homework/" rel="tag"># homework</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/02/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%91%98%E8%A6%81/" rel="prev" title="计算机网络·摘要">
      <i class="fa fa-chevron-left"></i> 计算机网络·摘要
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/04/01/PostgreSQL%E6%91%98%E8%A6%81/" rel="next" title="PostgreSQL摘要">
      PostgreSQL摘要 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">整体架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RISC-V%E6%8C%87%E4%BB%A4%E9%9B%86"><span class="nav-number">2.</span> <span class="nav-text">RISC-V指令集 </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.</span> <span class="nav-text">代码实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PC"><span class="nav-number">3.1.</span> <span class="nav-text">PC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PCincrement"><span class="nav-number">3.2.</span> <span class="nav-text">PCincrement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PCNext"><span class="nav-number">3.3.</span> <span class="nav-text">PCNext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Control"><span class="nav-number">3.4.</span> <span class="nav-text">Control</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#InstMem"><span class="nav-number">3.5.</span> <span class="nav-text">InstMem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RegFile"><span class="nav-number">3.6.</span> <span class="nav-text">RegFile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ImmGen"><span class="nav-number">3.7.</span> <span class="nav-text">ImmGen</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ALU-control"><span class="nav-number">3.8.</span> <span class="nav-text">ALU_control</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ALU-A"><span class="nav-number">3.9.</span> <span class="nav-text">ALU_A</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ALU-B"><span class="nav-number">3.10.</span> <span class="nav-text">ALU_B</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ALU"><span class="nav-number">3.11.</span> <span class="nav-text">ALU</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DataMem"><span class="nav-number">3.12.</span> <span class="nav-text">DataMem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Conditional"><span class="nav-number">3.13.</span> <span class="nav-text">Conditional</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RegBack"><span class="nav-number">3.14.</span> <span class="nav-text">RegBack</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#arch"><span class="nav-number">3.15.</span> <span class="nav-text">arch</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A3%E7%A1%AE%E6%80%A7%E9%AA%8C%E8%AF%81"><span class="nav-number">4.</span> <span class="nav-text">正确性验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E8%AE%B0"><span class="nav-number">5.</span> <span class="nav-text">注记</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xht03</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xht03</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://book-written-on-water.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://xht03.github.io/2024/03/06/RV64%E5%8D%95%E5%91%A8%E6%9C%9FCPU/";
    this.page.identifier = "2024/03/06/RV64单周期CPU/";
    this.page.title = "RV64单周期CPU";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://book-written-on-water.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

    </div>
</body>
</html>
